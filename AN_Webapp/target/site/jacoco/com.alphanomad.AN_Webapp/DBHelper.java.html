<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DBHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AN_Webapp</a> &gt; <a href="index.source.html" class="el_package">com.alphanomad.AN_Webapp</a> &gt; <span class="el_source">DBHelper.java</span></div><h1>DBHelper.java</h1><pre class="source lang-java linenums">package com.alphanomad.AN_Webapp;

import static org.asynchttpclient.Dsl.*;

import java.util.concurrent.ExecutionException;

import org.asynchttpclient.AsyncCompletionHandler;
import org.asynchttpclient.AsyncHttpClient;
import org.asynchttpclient.BoundRequestBuilder;
import org.asynchttpclient.ListenableFuture;
import org.asynchttpclient.Response;

import io.netty.util.concurrent.Future;

import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
/**
 * @author elgoni
 * much of this is based off of https://www.baeldung.com/async-http-client
 */
public class DBHelper {
	AsyncHttpClient client;
<span class="fc" id="L24">	String default_address = &quot;http://lamp.ms.wits.ac.za/~s1601745/&quot;;</span>
	public DBHelper()
<span class="fc" id="L26">	{</span>
<span class="fc" id="L27">		this.client = asyncHttpClient();</span>
		
<span class="fc" id="L29">	}</span>
	
	
	/**
	 * a general request for the php forms
	 * 
	 * @param endpoint the name of the file e.g signin
	 * @param params the name of the parameters as an array e.g {&quot;student_num&quot;,&quot;password&quot;} 
	 * @param values the values that correspond to the params e.g {&quot;1&quot;,&quot;test&quot;}
	 * @return returns a string with the body of the page e.g {&quot;result&quot;:1,&quot;name&quot;:&quot;Tutor&quot;,&quot;student_num&quot;:&quot;1&quot;,&quot;role&quot;:&quot;0&quot;}
	 *         if unsuccessful it will return the http response code as a string
	 *         if the params and values do not match it will return 400 
	 */
	public String php_request(String endpoint, String[] params, String[] values)
	{
<span class="fc" id="L44">		String result = &quot;&quot;;</span>
<span class="fc" id="L45">		String full_address = this.default_address + endpoint +&quot;.php?&quot;;</span>
		
<span class="fc" id="L47">		StringBuilder param_string = new StringBuilder();</span>
		try
		{
<span class="fc bfc" id="L50" title="All 2 branches covered.">			for(int x = 0; x &lt; params.length; x++)</span>
			{
<span class="fc" id="L52">				param_string.append(params[x]);</span>
<span class="fc" id="L53">				param_string.append(&quot;=&quot;);</span>
<span class="fc" id="L54">				param_string.append(values[x]);</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">				if(x!= params.length - 1)</span>
				{
<span class="fc" id="L57">					param_string.append(&quot;&amp;&quot;);</span>
				}
			}
		}
<span class="nc" id="L61">		catch(ArrayIndexOutOfBoundsException e)</span>
		{
<span class="nc" id="L63">			return &quot;400&quot;;</span>
<span class="fc" id="L64">		}</span>
		
		
<span class="fc" id="L67">		BoundRequestBuilder getRequest = client.prepareGet(full_address + param_string);</span>
<span class="fc" id="L68">		ListenableFuture&lt;Object&gt; http_result = getRequest.execute(new AsyncCompletionHandler&lt;Object&gt;() {</span>
		    @Override
		    public Object onCompleted(Response response) throws Exception {
<span class="fc" id="L71">		        return response;</span>
		    }
		});
		
		try {
<span class="fc" id="L76">			Response response = (Response) http_result.get();</span>
			
			//we only return the body if the request is successful
<span class="pc bpc" id="L79" title="1 of 4 branches missed.">			if(response.getStatusCode() &gt;= 200 &amp;&amp; response.getStatusCode() &lt; 300 ) </span>
			{
<span class="fc" id="L81">				return response.getResponseBody();</span>
			}
			else
			{
<span class="fc" id="L85">				return String.valueOf(response.getStatusCode());</span>
				
			}
			
			
<span class="nc" id="L90">		} catch (InterruptedException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L92">			e.printStackTrace();</span>
<span class="nc" id="L93">			return(&quot;INTERRUPTED&quot;);</span>
<span class="nc" id="L94">		} catch (ExecutionException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L96">			e.printStackTrace();</span>
<span class="nc" id="L97">			return(&quot;ERROR&quot;);</span>
		}
		
	}
	
	
	/**
	 * a method to convert the json string received from the server into a java object
	 * @param json_string the json to be parsed
	 * @return a JsonObject, 
	 * @see ProfileView#make_courses_panel 
	 * for an example of how to do this
	 */
	public JsonObject parse_json_string(String json_string)
	{
<span class="fc" id="L112">		JsonObject jsonObject = new JsonParser().parse(json_string).getAsJsonObject();</span>
<span class="fc" id="L113">		return jsonObject;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>